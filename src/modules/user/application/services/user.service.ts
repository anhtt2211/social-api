import { Injectable } from "@nestjs/common";
const jwt = require("jsonwebtoken");

import { JWT_SECRET_KEY } from "@configs";
import { UserEntity } from "../../core/entities/user.entity";

@Injectable()
export class UserService {
  constructor() {}

  public generateJWT(user) {
    let today = new Date();
    let exp = new Date(today);
    exp.setDate(today.getDate() + 60);

    return jwt.sign(
      {
        id: user.id,
        username: user.username,
        email: user.email,
        exp: exp.getTime() / 1000,
      },
      JWT_SECRET_KEY
    );
  }

  buildUserRO(user: UserEntity) {
    const userRO = {
      id: user.id,
      username: user.username,
      email: user.email,
      bio: user.bio,
      token: this.generateJWT(user),
      image: user.image,
    };

    return { user: userRO };
  }
}
