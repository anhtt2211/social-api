version: "2.6"

services:
  socia-api:
    build:
      context: .
      dockerfile: Dockerfile
    image: social-api
    ports:
      - "8000:8000"
    depends_on:
      - db
      - rabbitmq
      - redis
    environment:
      # - NODE_ENV=${NODE_ENV}
      - NODE_ENV=staging
      - DATABASE_HOST=host.docker.internal
      - DATABASE_PORT=${DATABASE_PORT}
      - DATABASE_ENGINE=${DATABASE_ENGINE}
      - DATABASE_USERNAME=${DATABASE_USERNAME}
      - DATABASE_PASSWORD=${DATABASE_PASSWORD}
      - WRITE_DATABASE_NAME=${WRITE_DATABASE_NAME}
      - READ_DATABASE_NAME=${READ_DATABASE_NAME}

      - TYPEORM_ENTITIES=${TYPEORM_ENTITIES}
      - TYPEORM_MIGRATIONS=${TYPEORM_MIGRATIONS}
      - TYPEORM_MIGRATIONS_DIR=${TYPEORM_MIGRATIONS_DIR}
      - TYPEORM_LOGGING=${TYPEORM_LOGGING}
      - TYPEORM_SYNCHRONIZE=${TYPEORM_SYNCHRONIZE}
      - TYPEORM_MIGRATION_RUN=${TYPEORM_MIGRATION_RUN}

      - DROPBOX_TOKEN=${DROPBOX_TOKEN}
      - DROPBOX_KEY=${DROPBOX_KEY}
      - DROPBOX_SECRET=${DROPBOX_SECRET}

      - RABBIT_URL=${RABBIT_URL}

      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}
  db:
    image: postgres
    environment:
      POSTGRES_USER: ${DATABASE_USERNAME}
      POSTGRES_PASSWORD: ${DATABASE_PASSWORD}
  rabbitmq:
    image: rabbitmq:3-management
    ports:
      - "15672:15672"
      - "5672:5672"
  redis:
    image: "redis:alpine"
    ports:
      - "6379:6379"
